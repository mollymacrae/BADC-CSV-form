<!DOCTYPE html>
<html>
<head>
    <title>Input Form</title>
    <style>
        .row-group {
        display: flex;
        gap: 1rem 0.25rem;
        align-items: flex-end;
        flex-wrap: wrap;
        }

        .row-group > div {
        flex: none;              /* prevent stretching */
        min-width: auto;         /* don’t enforce a minimum width */
        width: 200px;            /* set a fixed width per input */
        }

        .form-row {
            margin-bottom: 1rem; /* or 12px, 16px, etc. */
        }
        .creator-entry {
            margin-bottom: 0.5rem;
        }
        .metadata-value {
            width: 100%;
            max-width: 600px; /* Adjust this as needed */
            padding: 0.4rem;
            font-size: 1rem;
        }

    </style>
</head>
<body>
    <h1>Create BADC-CSV header</h1>
    <p style="margin-top: -10px; font-size: 0.95em; color: #555;">
        Fill out this form to create a template to convert your CSV data to self-describing BADC-CSV format. <br>
        This form assumes your data is organised in columns. 
        - Add creators and contributors to the dataset<br>
        - Add information to describe each column of the dataset (long_name, column number, units,standard_name (optional), type (optional))<br>
        - Add any additional metadata or comments<br>
        When you are ready click 'Submit' to download your BADC-CSV header.
    </p>
    <form method="post" onsubmit="return validateForm();">
        {% csrf_token %}

        
        <!-- SINGLE title outside the container -->
        <h2>Dataset title</h2>
        <label for="title">Title:</label>
        <input type="text" name="title" required><br><br>


        <h2>Creators and Contributors</h2>
        <p style="margin-top: -10px; font-size: 0.95em; color: #555;">
        Add individuals who created or contributed to the dataset and the columns that they contributed to (if all put 'G' for global)
        </p>

        <div id="creators-container">
        <div class="creator-entry">

            <div class="row-group">
                <div>
                    <label>Role:</label><br>
                    <select name="person_role">
                    <option value="creator">Creator</option>
                    <option value="contributor">Contributor</option>
                    </select><br>
                </div>

                <div>
                    <label>Column Number:</label><br>
                    <input type="text" name="person_column_number" required placeholder="e.g. 3 or G">
                </div>

                <div>
                    <label>Name:</label><br>
                    <input type="text" name="person_name"><br>
                </div>
                

                <div>
                    <label>Institution:</label><br>
                    <input type="text" name="institution" placeholder="e.g. UK Met Office"><br>
                </div>

                <div>
                    <label>Additional Info:</label><br>
                    <input type="text" name="additional_creator_info" placeholder="Optional"><br>
                </div>
                </div>
        </div>
        </div>

        <button type="button" onclick="addCreator()">+ Add Person</button><br><br>

        <!-- SINGLE title outside the container -->
        <h2>Column metadata</h2>
        <p style="margin-top: -10px; font-size: 0.95em; color: #555;">
            Add column metadata here to describe each column of the CSV dataset
        </p>

        <div id="variables-container">
            <div class="variable-entry">
                
                <p style="margin-top: -10px; font-size: 0.95em; color: #555;">
                        Please provide a long name, column number and units, and optionally a standard name and type.
                </p>
                <div class="form-row">
                    <div class="row-group">
                        <div>
                            <label>Long Name:</label><br>
                            <input type="text" name="long_name" required placeholder="e.g. Air Temperature">
                        </div>
                        <div>
                            <label>Column Number:</label><br>
                            <input type="number" name="column_number" required placeholder="e.g. 3">
                        </div>
                        <div>
                            <label>Units:</label><br>
                            <input type="text" name="units" required placeholder="e.g. K">
                        </div>
                        </div>
                </div>

                <div class="form-row">
                    <label>Standard Name (optional):</label><br>
                    <input type="text" name="standard_name" placeholder="e.g. air_temperature"><br>
                </div>
                <div class="form-row">
                    <label>Type (optional):</label><br>
                    <input type="text" name="type" placeholder="e.g. float"><br>
                </div>
            </div>
        </div>

        <button type="button" onclick="addVariable()">+ Add Column</button><br><br>


        <h2>Additional Metadata</h2>
        <p style="margin-top: -10px; font-size: 0.95em; color: #555;">
        Add additional metadata here.
        </p>
        <div id="metadata-container">
            <div class="metadata-entry">
                <label>Metadata Type:</label>
                <select name="metadata_type" onchange="updateExample(this)">
                    <option value="comment">Comment</option>
                    <option value="coordinate_variable">coordinate_variable</option>
                    <option value="start_time">Start time</option>
                    <option value="end_time">End time</option>
                    <option value="rights">Rights</option>
                    <option value="source">Source</option>
                    <option value="reference">Reference</option>
                    <option value="last_revised_date">Last revised date</option>
                    <option value="history">History</option>
                </select>
                <label>Column Number:</label>
                <input type="text" name="metadata_column_number" required placeholder="e.g. 3 or G" >
                <br>
                <label for="metadata_value">Value:</label><br>
                <textarea name="metadata_value" id="metadata_value" placeholder="Useful information about dataset, e.g. Data is Sahel mean (lon: 20°W-30°E, lat: 10°N-20°N)" rows="3" cols="60"></textarea>

            </div>
        </div>

        <button type="button" onclick="addMetadata()">+ Add Metadata</button><br><br>

        <button type="submit">Submit</button>

    </form>

    <script>
        function addVariable() {
            const container = document.getElementById('variables-container');
            const entry = document.querySelector('.variable-entry');
            const newEntry = entry.cloneNode(true);

            // Clear inputs in the new block
            newEntry.querySelectorAll('input').forEach(input => input.value = '');
            container.appendChild(newEntry);
        }
    </script>

    <script>
        function addCreator() {
            const container = document.getElementById('creators-container');
            const entry = container.querySelector('.creator-entry');
            const clone = entry.cloneNode(true);

            // Clear the cloned input value
            clone.querySelector('input').value = '';

            container.appendChild(clone);
            }
    </script>

    <script>

        function updateExample(select) {
            const valueField = select.parentElement.querySelector('textarea');
            const exampleMap = {
                'coordinate_variable': 'Flag for coordinate variables, optionally a plotting axis suggestion and the name of the coord ref system, e.g. x',
                'comment': 'Useful information about dataset, e.g. Data is Sahel mean (lon: 20°W-30°E, lat: 10°N-20°N)',
                'start_time': 'Data start time, e.g. 06/05/2009',
                'end_time': 'Data end time, e.g. 06/05/2019',
                'rights': 'Statement about the ownership of the data and that they are made available under a specific licence, e.g. open government licence http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/',
                'reference': 'Dataset references, e.g. Jury, M.; Turner, A.; Shonk, J. (2023): Chapter 10 of the Working Group I Contribution to the IPCC Sixth Assessment Report - data for Figure 10.11 (v20220622). NERC EDS Centre for Environmental Data Analysis, 17 May 2023. doi:10.5285/970847e5690c4f9e8c4ad455641bd558. https://dx.doi.org/10.5285/970847e5690c4f9e8c4ad455641bd558',
                'last_revised_date': 'Date the data, file or metadata were last changed, e.g. 04/06/2010',
                'history': 'Free text description of the file history, e.g.2009-05-11 : File created. 64278 data lines written to file.'

        };
        valueField.placeholder = exampleMap[select.value] || 'Enter value';
        }
    </script>

    <script>
        function addMetadata() {
            const container = document.getElementById('metadata-container');
            const first = document.querySelector('.metadata-entry');
            const clone1 = first.cloneNode(true);

            // Clear values
            const select = clone1.querySelector('select');
            const textarea = clone1.querySelector('textarea');

            select.selectedIndex = 0;
            textarea.value = '';
            updateExample(select);  // Reset placeholder

            container.appendChild(clone1);
        }
    </script>

    <script>
        function validateForm() {
            const columnInputs = document.querySelectorAll('input[name="column_number"]');
            for (let input of columnInputs) {
                const val = input.value.trim();
                if (!/^\d+$/.test(val) && val.toUpperCase() !== 'G') {
                alert("Column Number must be a positive integer or 'G'");
                return false; // prevent form submission
                }
            }
            return true;
        }
    </script>

</body>
</html>
